fragment ProjectDetail on projects_metadata {
  id
  project_id
  name
  description
  invocations
  max_invocations
  active
  paused
  complete
  artist_name
  contract_address
  start_datetime
  vertical_name
  vertical {
    category_name
  }
  tags {
    tag_name
  }
}

fragment TokenDetail on tokens_metadata {
  invocation
  project {
    name
    artist_name
  }
  contract {
    token_base_url
    name
  }
  preview_asset_url
  live_view_url
  list_currency_symbol
  list_price
  owner {
    public_address
  }
  isFlaggedAsSuspicious
}

fragment ProjectTokenDetail on tokens_metadata {
  id
  project_id
  invocation
}

fragment ContractDetail on contracts_metadata {
  address
  name
}

query getAllProjects($first: Int!, $skip: Int) {
  projects_metadata(
    limit: $first
    offset: $skip
    order_by: { project_id: asc }
    where: { active: { _eq: true } }
  ) {
    ...ProjectDetail
  }
}

query getProjectInContracts($contracts: [String!], $projectId: String!) {
  projects_metadata(
    where: {
      project_id: { _eq: $projectId }
      contract_address: { _in: $contracts }
      active: { _eq: true }
    }
    limit: 1
  ) {
    ...ProjectDetail
  }
}

query getWalletTokens(
  $wallet: String!
  $contracts: [String!]!
  $first: Int!
  $skip: Int
) {
  tokens_metadata(
    limit: $first
    offset: $skip
    where: {
      owner_address: { _eq: $wallet }
      contract_address: { _in: $contracts }
      project: { active: { _eq: true } }
    }
  ) {
    ...TokenDetail
  }
}

query getToken($token_id: String!) {
  tokens_metadata(limit: 1, where: { id: { _eq: $token_id } }) {
    ...TokenDetail
  }
}

query getContractProjects($contract: String!, $first: Int!, $skip: Int) {
  projects_metadata(
    limit: $first
    offset: $skip
    order_by: { project_id: asc }
    where: { contract_address: { _eq: $contract }, active: { _eq: true } }
  ) {
    ...ProjectDetail
  }
}

query getOpenProjects($contracts: [String!], $first: Int!, $skip: Int) {
  projects_metadata(
    limit: $first
    offset: $skip
    order_by: { project_id: asc }
    where: {
      paused: { _eq: false }
      active: { _eq: true }
      complete: { _eq: false }
      contract_address: { _in: $contracts }
    }
  ) {
    ...ProjectDetail
  }
}

query getProject($id: String!) {
  projects_metadata(where: { id: { _eq: $id }, active: { _eq: true } }) {
    ...ProjectDetail
  }
}

query getEngineContracts($ids: [String!]) {
  contracts_metadata(
    where: { address: { _nin: $ids }, active: { _eq: true } }
  ) {
    address
  }
}

query getProjectInvocations($id: String!) {
  projects_metadata(where: { id: { _eq: $id } }) {
    invocations
  }
}

query getProjectFloor($id: String!) {
  projects_metadata(where: { id: { _eq: $id } }) {
    tokens(limit: 3, order_by: { list_eth_price: asc }) {
      invocation
      list_eth_price
      isFlaggedAsSuspicious
    }
  }
}

query getAllContracts {
  contracts_metadata {
    ...ContractDetail
  }
}

query getMostRecentMintedTokenByContract($contracts: [String!]!) {
  tokens_metadata(
    order_by: [{ minted_at: desc }, { invocation: desc }]
    limit: 1
    where: {
      contract_address: { _in: $contracts }
      image_id: { _is_null: false }
      project: { active: { _eq: true } }
    }
  ) {
    ...ProjectTokenDetail
  }
}

query getMostRecentMintedFlagshipToken {
  tokens_metadata(
    order_by: [{ minted_at: desc }, { invocation: desc }]
    limit: 1
    where: {
      project: {
        vertical: { category: { hosted: { _eq: true } } }
        active: { _eq: true }
      }
      image_id: { _is_null: false }
    }
  ) {
    ...ProjectTokenDetail
  }
}
